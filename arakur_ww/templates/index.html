{% extends "base.html" %}


{% block content %}
<script type="text/javascript">
(function(){  
    first_load = true;  

    function update(state){
        //Instrumentos
        var actual_program = state.programs[state.params.programa_actual - 1];

        update_bar("turbiedad", state.instant_values.cloudiness, "NTU", state.params.cloudiness_max); 
        update_bar("nivel", state.instant_values.level, "%");   
        update_bar("oxigeno", state.instant_values.oxigen, "mg/Litro", state.params.oxigen_max);
        //Volumenes
        update_tag("volumen_tratado", state.instant_values.volumen_tratado, 'm³');
        update_tag("volumen_tratado_parcial", state.instant_values.volumen_tratado, 'm³');
        //Progreso
        update_tag("programa_actual", state.params.programa_actual);
        var process_times = ['carga_aireada', 'sedimentacion', 'descarga', 'aireacion'];
    
        for(var n=0; n<process_times.length; n++){
            var tag = process_times[n];
            update_tag("programa_" + tag, actual_program[tag], 'minutos');
            update_bar(tag, state.instant_values[tag], 'minutos', actual_program[tag]);
        }; 

        if (first_load){
            for(var i = 0; i < state.alarms.length; i++){
                set_alert(state.alarms[i]);                
                };
            for(var i = 0; i < state.events.length; i++){
                set_notify(state.events[i]);                
                };
            first_load = false;
        } else {
            for(var i = 0; i < state.new_alarms.length; i++){
                set_alert(state.new_alarms[i]);                
            }; 
            for(var i = 0; i < state.new_events.length; i++){
                set_notify(state.new_events[i]);                
            };
}; 
    };
    state_handler(update);
})();

</script>

  <ul class="nav nav-tabs">
    <li class='active'> 
    <a href='#'>Dashboard</a>
    </li>

    <li> 
    <a href='/graficos'>Graficos</a>
    </li>

    <li> 
    <a href='/admin'>Admin</a>
    </li>
  </ul>
  
  <div class="row">
    <div class="span3">
      <h4> Instrumentos </h4>
      <dl>
        <dt>Nivel en SBR</dt>
        <dd>
        <div class="progress progress-info progress-striped">
          <div id="nivel" class="bar" style="width: 0%">0%</div>
        </div>
        </dd>

        <dt> Oxígeno </dt>
        <dd>
        <div class="progress progress-info progress-striped">
          <div id="oxigeno" class="bar" style="width: 0%"> 0 mg/Litro</div>
        </div> 
        </dd> 
        <dt> Turbiedad </dt>
        <dd>
        <div class="progress progress-info progress-striped">
          <div id="turbiedad" class="bar" style="width: 0%">0 NTU</div>
        </div>
        </dd> 
      </dl>
    </div>
    <div class="span3">
      <h4> Volumen Acumulado </h4>
      <dl>
        <dt> Total</dt>
        <dd id='volumen_tratado'></dd>
        <dt> Parcial </dt>
        <dd id='volumen_tratado_parcial'></dd>
      </dl>
      <input type="button" class="btn btn-primary btn-block" value="Reset Parcial" 
      onclick="$.get('{{url_for("reset_acumulado")}}')"/>
    </div>
    <div class="span3">
      <h4> Programa </h4>
      <dl>
        <dt> Número </dt>
        <dd id='programa_actual'></dd> 
        <dt> Carga Aireada </dt>
        <dd id="programa_carga_aireada"></dd> 
        <dt> Aireación </dt>
        <dd id="programa_aireacion"></dd>
        <dt> Sedimentación </dt>
        <dd id="programa_sedimentacion"></dd>
        <dt> Descarga </dt>
        <dd id="programa_descarga"> </dd>
      </dl>
    </div>
    <div class="span3">
      <h4> Progreso </h4>
      <dl>
        <dt> Carga Aireada </dt>
        <dd>
        <div id="programa_carga_aireada" class="centered"></div>
        <div class="progress progress-info progress-striped">
          <div id="carga_aireada" class="bar" style="width: 0%">0 minutos</div>
        </div>
        </dd> 
        <dt> Aireación </dt>
        <dd>
        <div id="programa_aireacion" class="centered"></div>
        <div class="progress progress-info progress-striped">
          <div id="aireacion" class="bar" style="width: 0%">0 minutos</div>
        </div>
        </dd>
        <dt> Sedimentación </dt>
        <dd>
        <div id="programa_sedimentacion" class="centered"></div>
        <div class="progress progress-info progress-striped">
          <div id="sedimentacion" class="bar" style="width: 0%">0 minutos</div>
        </div>
        </dd>
        <dt> Descarga </dt>
        <dd>
        <div id="programa_descarga" class='centered'></div>
        <div class="progress progress-info progress-striped">
          <div id="descarga" class="bar" style="width: 0%">0 minutos</div>
        </div>
        </dd>
      </dl>
    </div>
  </div>
  <div class="row">
    <div class="span6">
      <h4> Alarmas </h4>
      <input type="button" class="btn btn-primary btn-block" value="Detener alarma acustica" onclick="$.get('{{url_for("detener_alarma")}}')"/>
      <div id='alert_container'>
      </div>
    </div>
    <div class="span6">
      <h4> Eventos </h4>
      <div id="event_container" height="50%" style="overflow: auto;">
      </div>
    </div>
  </div>

{% endblock %}
